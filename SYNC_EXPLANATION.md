# üîÑ –Ø–ö –ü–†–ê–¶–Æ–Ñ –°–ò–ù–•–†–û–ù–Ü–ó–ê–¶–Ü–Ø –ü–†–û–ì–†–ê–ú

## üìã –ó–∞–≥–∞–ª—å–Ω–∞ –°—Ö–µ–º–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    –°–ò–ù–•–†–û–ù–Ü–ó–ê–¶–Ü–Ø –ü–†–û–ì–†–ê–ú                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

1Ô∏è‚É£  –ê–í–¢–û–ú–ê–¢–ò–ß–ù–ê –°–ò–ù–•–†–û–ù–Ü–ó–ê–¶–Ü–Ø (–ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏)
    ‚Üì
    Frontend: ProgramsList.tsx ‚Üí useEffect() ‚Üí handleSyncWithSSE(true)
    ‚Üì
    Backend: /api/reseller/programs/sync-stream (POST)
    ‚Üì
    ProgramSyncService.sync_programs()
    ‚Üì
    –ü–µ—Ä–µ–≤—ñ—Ä—è—î: API total_count vs –ë–î total_count
    ‚Üì
    –Ø–∫—â–æ API > –ë–î ‚Üí –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î –Ω–æ–≤—ñ –ø—Ä–æ–≥—Ä–∞–º–∏
    ‚Üì
    –ó–±–µ—Ä—ñ–≥–∞—î –≤ –ë–î (ProgramRegistry)

2Ô∏è‚É£  –†–£–ß–ù–ê –°–ò–ù–•–†–û–ù–Ü–ó–ê–¶–Ü–Ø (–∫–Ω–æ–ø–∫–∞ "Sync Programs")
    ‚Üì
    –¢–æ–π —Å–∞–º–∏–π –ø—Ä–æ—Ü–µ—Å, –∞–ª–µ –∑ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É
```

## üîç –î–µ—Ç–∞–ª—å–Ω–∏–π –ü—Ä–æ—Ü–µ—Å

### 1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è

**–ö–æ–ª–∏ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è:**
- –ü—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ `/programs`
- –¢—ñ–ª—å–∫–∏ —è–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–æ–≤–∞–Ω–∏–π (—î username + password)

**–ö–æ–¥ (Frontend):**
```typescript
// ProgramsList.tsx, —Ä—è–¥–æ–∫ 352-357
useEffect(() => {
  if (isAuthenticated) {
    console.log('üöÄ [AUTO-SYNC] Component mounted, starting automatic sync...');
    handleSyncWithSSE(true); // isAutomatic = true
  }
}, []); // –ó–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ mount
```

**–©–æ —Ä–æ–±–∏—Ç—å:**
1. –í—ñ–¥–ø—Ä–∞–≤–ª—è—î POST –∑–∞–ø–∏—Ç –Ω–∞ `/api/reseller/programs/sync-stream`
2. –û—Ç—Ä–∏–º—É—î SSE (Server-Sent Events) stream –∑ –ø—Ä–æ–≥—Ä–µ—Å–æ–º
3. –ü–æ–∫–∞–∑—É—î –ø—Ä–æ–≥—Ä–µ—Å —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó (—è–∫—â–æ —î –Ω–æ–≤—ñ –ø—Ä–æ–≥—Ä–∞–º–∏)
4. –ü—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –æ–Ω–æ–≤–ª—é—î —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–≥—Ä–∞–º

### 2. Backend –õ–æ–≥—ñ–∫–∞

**Endpoint:** `POST /api/reseller/programs/sync-stream`

**–ö–æ–¥ (Backend):**
```python
# views.py - ProgramSyncStreamView
def post(self, request):
    username = request.user.username
    
    # 1. –ü–µ—Ä–µ–≤—ñ—Ä—è—î —Å–∫—ñ–ª—å–∫–∏ –ø—Ä–æ–≥—Ä–∞–º –≤ API
    api_total = ProgramSyncService.get_total_programs_from_api(username)
    
    # 2. –ü–µ—Ä–µ–≤—ñ—Ä—è—î —Å–∫—ñ–ª—å–∫–∏ –ø—Ä–æ–≥—Ä–∞–º –≤ –ë–î
    db_total = ProgramSyncService.get_total_programs_in_db(username)
    
    # 3. –Ø–∫—â–æ API > –ë–î ‚Üí —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É—î —Ä—ñ–∑–Ω–∏—Ü—é
    if api_total > db_total:
        new_programs = api_total - db_total
        # –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î –Ω–æ–≤—ñ –ø—Ä–æ–≥—Ä–∞–º–∏ –±–∞—Ç—á–∞–º–∏ –ø–æ 20
        sync_programs(username, batch_size=20)
    else:
        # –ù—ñ—á–æ–≥–æ —Ä–æ–±–∏—Ç–∏ –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ
        return "already_synced"
```

### 3. –©–æ –ó–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –≤ –ë–î

**–¢–∞–±–ª–∏—Ü—è:** `ads_programregistry`

**–ü–æ–ª—è:**
- `program_id` - —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π ID –ø—Ä–æ–≥—Ä–∞–º–∏
- `yelp_business_id` - ID –±—ñ–∑–Ω–µ—Å—É
- `program_name` - —Ç–∏–ø –ø—Ä–æ–≥—Ä–∞–º–∏ (CPC, BP, EP, —ñ —Ç.–¥.)
- `status` - —Å—Ç–∞—Ç—É—Å (CURRENT, PAST, FUTURE, PAUSED, INACTIVE)
- `username` - –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —è–∫–æ–º—É –Ω–∞–ª–µ–∂–∏—Ç—å –ø—Ä–æ–≥—Ä–∞–º–∞
- `created_at` - –∫–æ–ª–∏ –¥–æ–¥–∞–Ω–æ –≤ –ë–î
- `updated_at` - –∫–æ–ª–∏ –æ–Ω–æ–≤–ª–µ–Ω–æ

**–ü—Ä–∏–∫–ª–∞–¥:**
```
program_id: 5O-Jk-5KbqkPClw1YvaqVA
yelp_business_id: e2JTWqyUwRHXjpG8TCZ7Ow
program_name: CPC
status: CURRENT
username: 0il7Tv&R$#6\
```

## ‚ùì –ß–û–ú–£ –ü–†–û–ì–†–ê–ú–ê –ù–ï –°–ò–ù–•–†–û–ù–Ü–ó–£–í–ê–õ–ê–°–Ø –ê–í–¢–û–ú–ê–¢–ò–ß–ù–û?

### –ú–æ–∂–ª–∏–≤—ñ –ü—Ä–∏—á–∏–Ω–∏:

1. **–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω—ñ–π —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó**
   - –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ console.log –≤ –±—Ä–∞—É–∑–µ—Ä—ñ (F12)
   - –®—É–∫–∞–π—Ç–µ –ø–æ–º–∏–ª–∫–∏ —Ç–∏–ø—É: `‚ùå [SSE] Sync failed`

2. **–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–µ –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–æ–≤–∞–Ω–∏–π**
   - –Ø–∫—â–æ –Ω–µ–º–∞—î username/password –≤ Redux store
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –Ω–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è

3. **Endpoint –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π**
   - `/api/reseller/programs/sync-stream` –ø–æ–≤–µ—Ä—Ç–∞—î 404
   - –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —á–∏ –ø—Ä–∞—Ü—é—î backend

4. **CORS –∞–±–æ –º–µ—Ä–µ–∂–µ–≤—ñ –ø–æ–º–∏–ª–∫–∏**
   - –ë–ª–æ–∫—É–≤–∞–Ω–Ω—è –±—Ä–∞—É–∑–µ—Ä–æ–º
   - –ü—Ä–æ–±–ª–µ–º–∏ –∑ –∑'—î–¥–Ω–∞–Ω–Ω—è–º

5. **–ü—Ä–æ–≥—Ä–∞–º–∞ —Å—Ç–≤–æ—Ä–µ–Ω–∞ –ü–Ü–°–õ–Ø –æ—Å—Ç–∞–Ω–Ω—å–æ—ó —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó**
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏
   - –Ø–∫—â–æ –≤–∏ —Å—Ç–≤–æ—Ä–∏–ª–∏ –ø—Ä–æ–≥—Ä–∞–º—É —á–µ—Ä–µ–∑ Yelp UI, –ø–æ—Ç—Ä—ñ–±–Ω–æ:
     a) –û–Ω–æ–≤–∏—Ç–∏ —Å—Ç–æ—Ä—ñ–Ω–∫—É (F5) ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è
     b) –ù–∞—Ç–∏—Å–Ω—É—Ç–∏ "Sync Programs" ‚Üí —Ä—É—á–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è

## üéØ –†–ï–ö–û–ú–ï–ù–î–ê–¶–Ü–á

### –î–ª—è –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤:

1. **–Ø–∫—â–æ –Ω–µ –±–∞—á–∏—Ç–µ –Ω–æ–≤—É –ø—Ä–æ–≥—Ä–∞–º—É:**
   - –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å F5 (–æ–Ω–æ–≤–∏—Ç–∏ —Å—Ç–æ—Ä—ñ–Ω–∫—É)
   - –ê–±–æ –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å "Sync Programs"

2. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞:**
   - F12 ‚Üí Console
   - –®—É–∫–∞–π—Ç–µ `üöÄ [AUTO-SYNC]` –∞–±–æ `‚ùå [SSE]`

### –î–ª—è –†–æ–∑—Ä–æ–±–Ω–∏–∫—ñ–≤:

1. **–î–æ–¥–∞—Ç–∏ –ª–æ–≥—É–≤–∞–Ω–Ω—è:**
   ```typescript
   console.log('üöÄ [AUTO-SYNC] Starting...');
   console.log('üìä [SSE] Event received:', eventData);
   console.log('‚úÖ [SSE] Completed');
   ```

2. **–î–æ–¥–∞—Ç–∏ toast –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è:**
   ```typescript
   if (eventData.type === 'complete' && eventData.added > 0) {
     toast({
       title: "Programs Synced",
       description: `Added ${eventData.added} new programs`,
     });
   }
   ```

3. **–î–æ–¥–∞—Ç–∏ —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó:**
   - –ü–æ–∫–∞–∑—É–≤–∞—Ç–∏ spinner –ø—ñ–¥ —á–∞—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ—ó —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó
   - –ü–æ–∫–∞–∑—É–≤–∞—Ç–∏ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –Ω–æ–≤–∏—Ö –ø—Ä–æ–≥—Ä–∞–º

## üîß –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø

### –Ü–Ω—Ç–µ—Ä–≤–∞–ª –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ—ó –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó:

**–ó–∞—Ä–∞–∑:** –¢—ñ–ª—å–∫–∏ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ (–æ–¥–∏–Ω —Ä–∞–∑)

**–ú–æ–∂–Ω–∞ –¥–æ–¥–∞—Ç–∏ –ø–µ—Ä—ñ–æ–¥–∏—á–Ω—É —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—é:**
```typescript
useEffect(() => {
  if (isAuthenticated) {
    // –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω
    const interval = setInterval(() => {
      handleSyncWithSSE(true);
    }, 5 * 60 * 1000); // 5 —Ö–≤–∏–ª–∏–Ω
    
    return () => clearInterval(interval);
  }
}, [isAuthenticated]);
```

### –†–æ–∑–º—ñ—Ä –ë–∞—Ç—á—É:

**–ó–∞—Ä–∞–∑:** 20 –ø—Ä–æ–≥—Ä–∞–º –∑–∞ —Ä–∞–∑

**–ú–æ–∂–Ω–∞ –∑–º—ñ–Ω–∏—Ç–∏ –≤:**
```python
# views.py - ProgramSyncStreamView
result = ProgramSyncService.sync_programs(username, batch_size=50)  # –ó–±—ñ–ª—å—à–∏—Ç–∏ –¥–æ 50
```

## üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê –°–ò–ù–•–†–û–ù–Ü–ó–ê–¶–Ü–á

–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å–∫—ñ–ª—å–∫–∏ –ø—Ä–æ–≥—Ä–∞–º —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–æ–≤–∞–Ω–æ:

```sql
-- –ó–∞–≥–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ø—Ä–æ–≥—Ä–∞–º
SELECT COUNT(*) FROM ads_programregistry;

-- –ü–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º
SELECT username, COUNT(*) 
FROM ads_programregistry 
GROUP BY username;

-- –ü–æ —Å—Ç–∞—Ç—É—Å–∞–º
SELECT status, COUNT(*) 
FROM ads_programregistry 
WHERE username = '0il7Tv&R$#6\' 
GROUP BY status;
```

## üêõ –î–ï–ë–ê–ì

### –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —á–∏ –ø—Ä–∞—Ü—é—î –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è:

1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12)
2. –ü–µ—Ä–µ–π–¥—ñ—Ç—å –Ω–∞ `/programs`
3. –®—É–∫–∞–π—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª—ñ:
   ```
   üöÄ [AUTO-SYNC] Component mounted, starting automatic sync...
   üîÑ [SSE] Automatic sync triggered
   üì° [SSE] Connected to sync stream
   üìä [SSE] Event received: {...}
   ‚úÖ [SSE] Stream completed
   ```

### –Ø–∫—â–æ –Ω–µ –ø—Ä–∞—Ü—é—î:

1. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ `isAuthenticated`:
   ```javascript
   console.log('isAuthenticated:', isAuthenticated);
   console.log('username:', username);
   console.log('password:', password ? '***' : 'missing');
   ```

2. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ endpoint:
   ```bash
   curl -X POST "http://localhost:8000/api/reseller/programs/sync-stream" \
     -u "username:password" \
     -H "Content-Type: application/json"
   ```

3. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏ backend:
   ```bash
   docker logs yelp-ads-dashboard-ui-backend-1 -f
   ```

## ‚úÖ –í–ò–°–ù–û–í–û–ö

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –ø—Ä–∞—Ü—é—î**, –∞–ª–µ:
- –ó–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏
- –ü–æ—Ç—Ä–µ–±—É—î –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó
- –ú–æ–∂–µ –º–æ–≤—á–∫–∏ –∑–∞–≤–µ—Ä—à–∏—Ç–∏—Å—è —è–∫—â–æ –Ω–µ–º–∞—î –Ω–æ–≤–∏—Ö –ø—Ä–æ–≥—Ä–∞–º

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è:** –î–æ–¥–∞—Ç–∏ –≤—ñ–∑—É–∞–ª—å–Ω–∏–π —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ—ó —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó, —â–æ–± –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –±–∞—á–∏–≤ —â–æ –ø—Ä–æ—Ü–µ—Å –≤—ñ–¥–±—É–≤—Å—è.
